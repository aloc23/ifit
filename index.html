<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cashflow Forecast Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f4f8fb; margin: 0; }
    .container { max-width: 950px; margin: 36px auto; background: #fff; border-radius: 12px; box-shadow: 0 6px 32px #0001; padding: 32px 36px 24px 36px; }
    h1 { color: #2377d8; font-size: 2.2em; margin-top: 0; }
    .repayment-controls { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; margin-bottom: 12px; }
    .repayment-controls input[type="number"] { padding: 6px 10px; }
    .repayment-controls input[type="file"] { margin-right: 8px; }
    .repayment-controls button { padding: 7px 15px; background: #e9f2fc; border: 1px solid #cde0f7; border-radius: 6px; cursor: pointer; font-weight: 500; }
    .repayment-controls button:hover { background: #dbeafd; }
    .summary { display: flex; flex-wrap: wrap; gap: 34px; align-items: center; background: #f4f8fb; border-radius: 7px; margin: 12px 0 16px 0; padding: 16px 20px 10px 20px; font-size: 1.14em; }
    .summary > div { min-width: 170px; }
    #lowestWeek details { display: inline-block; margin-left: 8px; vertical-align: middle; }
    #lowestWeek summary { font-size: .97em; cursor: pointer; color: #2377d8; }
    #negWeeksUl { margin: 4px 0 0 0; padding-left: 20px; }
    .chart-controls { margin-bottom: 10px; }
    #chartCanvas { background: #fff; border: 1px solid #e0e5ee; border-radius: 8px; margin-bottom: 18px; min-height: 320px; }
    .repayment-row { display: flex; gap: 8px; margin: 7px 0; }
    .repayment-row select, .repayment-row input { padding: 5px; border-radius: 4px; border: 1px solid #d1d6e0; }
    .spreadsheet-summary-scroll { overflow-x: auto; margin-bottom: 14px; }
    .spreadsheet-summary-table { border-collapse: collapse; min-width: 480px; }
    .spreadsheet-summary-table th, .spreadsheet-summary-table td { border: 1px solid #e0e5ee; padding: 6px 13px; text-align: center; }
    .spreadsheet-summary-table th.sticky-week-label { background: #f4f8fb; position: sticky; top: 0; z-index: 1; }
    .balance-row { background: #f7fafd; }
    #spreadsheetTable table { font-size: 0.95em; }
    .repayment-highlight { background: #ffe7b5; }
    #weekFilterControls { margin-bottom: 10px; }
    .dropdown-label { font-size: 1em; color: #2377d8; margin-right: 8px; }
    @media (max-width: 700px) {
      .container { padding: 10px; }
      .summary { flex-direction: column; gap: 7px; }
      .repayment-controls { flex-direction: column; gap: 7px; }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>Cashflow Forecast Tool</h1>
    <div class="repayment-controls">
      <input type="file" id="fileInput" />
      <input type="number" id="startingBalanceInput" placeholder="Starting Balance (matches your sheet)" style="width:180px;" />
      <input type="number" id="loanOutstandingInput" placeholder="Loan Amount Outstanding" style="width:180px;" min="0"/>
      <button id="addRepayment">+ Add Repayment</button>
      <button id="clearRepayments">Clear Repayments</button>
      <button id="savePlan">üíæ Save Plan</button>
      <button id="loadPlan">üìÅ Load Plan</button>
      <button id="exportPDF">Export to PDF</button>
      <button id="exportExcel">Export to Excel</button>
    </div>
    <div id="weekFilterControls" style="margin-bottom:10px;display:none;">
      <label class="dropdown-label">Show weeks:</label>
      <select id="startWeekSelect"></select>
      <span>to</span>
      <select id="endWeekSelect"></select>
    </div>
    <div class="summary">
      <div id="totalRepaid">Total Repaid: ‚Ç¨0</div>
      <div id="finalBankBalance">Final Bank Balance: ‚Ç¨0</div>
      <div id="remaining">Remaining: ‚Ç¨0</div>
      <div id="lowestWeek">
        Lowest Week: --
        <details id="negativeWeeksList" style="display:none;">
          <summary>Weeks with negative balance</summary>
          <ul id="negWeeksUl"></ul>
        </details>
      </div>
    </div>
    <div class="chart-controls" style="margin-bottom:12px;">
      <label for="chartType">Chart Type:</label>
      <select id="chartType">
        <option value="line">Line</option>
        <option value="bar">Bar</option>
        <option value="pie">Pie</option>
      </select>
      <label><input type="checkbox" id="toggleRepayments" checked> Show Repayments Overlay</label>
      <button id="resetZoom">Reset Zoom</button>
      <button id="exportPNG">Export Chart as PNG</button>
    </div>
    <canvas id="chartCanvas" height="360"></canvas>
    <div id="spreadsheetSummarySection"></div>
    <div id="repaymentInputs"></div>
    <button style="margin-top: 18px;" onclick="document.getElementById('spreadsheetTable').classList.toggle('hidden')">Show Full Spreadsheet Table</button>
    <div id="spreadsheetTable" class="hidden" style="margin-top: 15px;"></div>
  </div>
  <script src="script.js"></script>
</body>
</html>
